import{s as we,b as be,n as Ue,e as He,r as Ke}from"./scheduler.Cy9pk9AM.js";import{S as ke,i as Ee,y as Qe,H as Re,z as We,a as p,A as Xe,d as m,B as Oe,g as X,D as Le,o as w,x as fe,p as E,w as ue,e as v,t as O,s as P,k as Y,c as b,b as L,f as U,l as Z,m as g,h as c,n as $,v as Me,j as re,q as ee,C as Ye}from"./index.x6j4SjtJ.js";import{g as Ze,e as ze}from"./spread.4dapbekP.js";import{D as ce,U as $e,B as et,a as tt,b as lt}from"./bxs-downvote.Be72qWU0.js";import{g as Ne}from"./entry.B3rq6gI2.js";import{e as Ve}from"./public.CpIIhdHb.js";function rt(s){let t,l,e='<g fill="none" stroke="currentColor" stroke-linejoin="round"><path stroke-linecap="round" stroke-width="1.5" d="M12 21a9 9 0 1 0-8-4.873L3 21l4.873-1c1.236.639 2.64 1 4.127 1"/><path stroke-width="2.25" d="M7.5 12h.01v.01H7.5zm4.5 0h.01v.01H12zm4.5 0h.01v.01h-.01z"/></g>',r=[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},s[0]],o={};for(let i=0;i<r.length;i+=1)o=be(o,r[i]);return{c(){t=Qe("svg"),l=new Re(!0),this.h()},l(i){t=We(i,"svg",{viewBox:!0,width:!0,height:!0});var a=p(t);l=Xe(a,!0),a.forEach(m),this.h()},h(){l.a=null,Oe(t,o)},m(i,a){X(i,t,a),l.m(e,t)},p(i,[a]){Oe(t,o=Ze(r,[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},a&1&&i[0]]))},i:Ue,o:Ue,d(i){i&&m(t)}}}function st(s,t,l){return s.$$set=e=>{l(0,t=be(be({},t),He(e)))},t=He(t),[t]}class nt extends ke{constructor(t){super(),Ee(this,t,st,rt,we,{})}}function qe(s){let t,l,e,r,o=s[0].user.username+"",i,a,I,f,u=s[0].title+"",n,d,y,H,K,Q,h,j,se,_e,M,x,N,T,D,me,R,ne,he,V,S,A,de,z,q,ge,te,le=s[0].comments.length+"",oe,C,pe,Ie;const ye=[at,ot],F=[];function Be(_,k){return _[2]?0:1}T=Be(s),D=F[T]=ye[T](s);const je=[ft,it],G=[];function Te(_,k){return _[1]?0:1}return S=Te(s),A=G[S]=je[S](s),q=new nt({}),{c(){t=v("div"),l=v("a"),e=v("a"),r=O("@"),i=O(o),I=P(),f=v("h1"),n=O(u),d=P(),y=v("p"),H=O(s[5]),K=O("..."),Q=P(),h=v("p"),j=O(s[4]),_e=P(),M=v("span"),x=v("div"),N=v("button"),D.c(),me=P(),R=v("small"),ne=O(s[3]),he=P(),V=v("button"),A.c(),de=P(),z=v("div"),Y(q.$$.fragment),ge=P(),te=v("span"),oe=O(le),this.h()},l(_){t=b(_,"DIV",{class:!0});var k=p(t);l=b(k,"A",{class:!0,href:!0});var B=p(l);e=b(B,"A",{class:!0,href:!0});var J=p(e);r=L(J,"@"),i=L(J,o),J.forEach(m),I=U(B),f=b(B,"H1",{class:!0});var De=p(f);n=L(De,u),De.forEach(m),d=U(B),y=b(B,"P",{class:!0});var ve=p(y);H=L(ve,s[5]),K=L(ve,"..."),ve.forEach(m),Q=U(B),h=b(B,"P",{class:!0});var Se=p(h);j=L(Se,s[4]),Se.forEach(m),B.forEach(m),_e=U(k),M=b(k,"SPAN",{class:!0});var ae=p(M);x=b(ae,"DIV",{class:!0});var W=p(x);N=b(W,"BUTTON",{});var Ae=p(N);D.l(Ae),Ae.forEach(m),me=U(W),R=b(W,"SMALL",{class:!0});var xe=p(R);ne=L(xe,s[3]),xe.forEach(m),he=U(W),V=b(W,"BUTTON",{});var Ce=p(V);A.l(Ce),Ce.forEach(m),W.forEach(m),de=U(ae),z=b(ae,"DIV",{class:!0});var ie=p(z);Z(q.$$.fragment,ie),ge=U(ie),te=b(ie,"SPAN",{});var Pe=p(te);oe=L(Pe,le),Pe.forEach(m),ie.forEach(m),ae.forEach(m),k.forEach(m),this.h()},h(){g(e,"class","text-sm mb-2 hover:text-primary"),g(e,"href",a=`/profile/${s[0].userId}`),g(f,"class","text-lg"),g(y,"class","text-sm"),g(h,"class","text-xs mt-2"),g(l,"class","flex flex-col"),g(l,"href",se=`/posts/${s[0].id}`),g(R,"class","text-xs"),g(x,"class","flex gap-2 text-sm rounded-xl bg-base-200 px-2 py-1"),g(z,"class","flex gap-2 text-sm rounded-xl bg-base-200 px-2 py-1"),g(M,"class","flex gap-2"),g(t,"class","p-8 border rounded-lg hover:bg-base-300 flex flex-col gap-2")},m(_,k){X(_,t,k),c(t,l),c(l,e),c(e,r),c(e,i),c(l,I),c(l,f),c(f,n),c(l,d),c(l,y),c(y,H),c(y,K),c(l,Q),c(l,h),c(h,j),c(t,_e),c(t,M),c(M,x),c(x,N),F[T].m(N,null),c(x,me),c(x,R),c(R,ne),c(x,he),c(x,V),G[S].m(V,null),c(M,de),c(M,z),$(q,z,null),c(z,ge),c(z,te),c(te,oe),C=!0,pe||(Ie=[Me(N,"click",s[6]),Me(V,"click",s[7])],pe=!0)},p(_,k){(!C||k&1)&&o!==(o=_[0].user.username+"")&&re(i,o),(!C||k&1&&a!==(a=`/profile/${_[0].userId}`))&&g(e,"href",a),(!C||k&1)&&u!==(u=_[0].title+"")&&re(n,u),(!C||k&1&&se!==(se=`/posts/${_[0].id}`))&&g(l,"href",se);let B=T;T=Be(_),T!==B&&(fe(),E(F[B],1,1,()=>{F[B]=null}),ue(),D=F[T],D||(D=F[T]=ye[T](_),D.c()),w(D,1),D.m(N,null)),(!C||k&8)&&re(ne,_[3]);let J=S;S=Te(_),S!==J&&(fe(),E(G[J],1,1,()=>{G[J]=null}),ue(),A=G[S],A||(A=G[S]=je[S](_),A.c()),w(A,1),A.m(V,null)),(!C||k&1)&&le!==(le=_[0].comments.length+"")&&re(oe,le)},i(_){C||(w(D),w(A),w(q.$$.fragment,_),C=!0)},o(_){E(D),E(A),E(q.$$.fragment,_),C=!1},d(_){_&&m(t),F[T].d(),G[S].d(),ee(q),pe=!1,Ke(Ie)}}}function ot(s){let t,l;return t=new $e({}),{c(){Y(t.$$.fragment)},l(e){Z(t.$$.fragment,e)},m(e,r){$(t,e,r),l=!0},i(e){l||(w(t.$$.fragment,e),l=!0)},o(e){E(t.$$.fragment,e),l=!1},d(e){ee(t,e)}}}function at(s){let t,l;return t=new et({}),{c(){Y(t.$$.fragment)},l(e){Z(t.$$.fragment,e)},m(e,r){$(t,e,r),l=!0},i(e){l||(w(t.$$.fragment,e),l=!0)},o(e){E(t.$$.fragment,e),l=!1},d(e){ee(t,e)}}}function it(s){let t,l;return t=new tt({}),{c(){Y(t.$$.fragment)},l(e){Z(t.$$.fragment,e)},m(e,r){$(t,e,r),l=!0},i(e){l||(w(t.$$.fragment,e),l=!0)},o(e){E(t.$$.fragment,e),l=!1},d(e){ee(t,e)}}}function ft(s){let t,l;return t=new lt({}),{c(){Y(t.$$.fragment)},l(e){Z(t.$$.fragment,e)},m(e,r){$(t,e,r),l=!0},i(e){l||(w(t.$$.fragment,e),l=!0)},o(e){E(t.$$.fragment,e),l=!1},d(e){ee(t,e)}}}function ut(s){let t,l,e=s[0].published&&qe(s);return{c(){e&&e.c(),t=Le()},l(r){e&&e.l(r),t=Le()},m(r,o){e&&e.m(r,o),X(r,t,o),l=!0},p(r,[o]){r[0].published?e?(e.p(r,o),o&1&&w(e,1)):(e=qe(r),e.c(),w(e,1),e.m(t.parentNode,t)):e&&(fe(),E(e,1,1,()=>{e=null}),ue())},i(r){l||(w(e),l=!0)},o(r){E(e),l=!1},d(r){r&&m(t),e&&e.d(r)}}}function ct(s,t,l){let e,r,o,i,a,I,f,{post:u}=t,{user:n}=t,{jwt:d}=t;const y=ce.fromISO(u.creationDate).toLocaleString(ce.DATETIME_MED),H=u.content.substring(0,100);async function K(){if(!n||!d){Ne("/login");return}I&&Q();const h=await fetch(`${Ve.PUBLIC_API_HOST}/api/posts/${u.id}/upvote`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}});if(h.ok)a?l(11,e=e.filter(j=>j.userId!==n.id)):l(11,e=[...e,{id:0,user:n,userId:n.id}]);else{const j=await h.json();console.error("Error:",j)}}async function Q(){if(!n||!d){Ne("/login");return}a&&K();const h=await fetch(`${Ve.PUBLIC_API_HOST}/api/posts/${u.id}/downvote`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}});if(h.ok)I?l(10,r=r.filter(j=>j.userId!==n.id)):l(10,r=[...r,{id:0,user:n,userId:n.id}]);else{const j=await h.json();console.error("Error:",j)}}return s.$$set=h=>{"post"in h&&l(0,u=h.post),"user"in h&&l(8,n=h.user),"jwt"in h&&l(9,d=h.jwt)},s.$$.update=()=>{s.$$.dirty&1&&l(11,e=u.upvotes),s.$$.dirty&1&&l(10,r=u.downvotes),s.$$.dirty&2048&&l(13,o=e?e.map(h=>h.userId):null),s.$$.dirty&1024&&l(12,i=r?r.map(h=>h.userId):null),s.$$.dirty&8448&&l(2,a=n&&o?o.includes(n.id):!1),s.$$.dirty&4352&&l(1,I=n&&i?i.includes(n.id):!1),s.$$.dirty&3072&&l(3,f=e&&r?e.length-r.length:"N/A")},[u,I,a,f,y,H,K,Q,n,d,r,e,i,o]}class _t extends ke{constructor(t){super(),Ee(this,t,ct,ut,we,{post:0,user:8,jwt:9})}}function Fe(s,t,l){const e=s.slice();return e[9]=t[l],e}function Ge(s){let t,l;return{c(){t=v("a"),l=O(s[0]),this.h()},l(e){t=b(e,"A",{class:!0,href:!0});var r=p(t);l=L(r,s[0]),r.forEach(m),this.h()},h(){g(t,"class","mb-4 text-2xl"),g(t,"href",s[1])},m(e,r){X(e,t,r),c(t,l)},p(e,r){r&1&&re(l,e[0]),r&2&&g(t,"href",e[1])},d(e){e&&m(t)}}}function Je(s){let t,l,e,r;return l=new _t({props:{post:s[9],user:s[2],jwt:s[3]}}),{c(){t=v("li"),Y(l.$$.fragment),e=P()},l(o){t=b(o,"LI",{});var i=p(t);Z(l.$$.fragment,i),e=U(i),i.forEach(m)},m(o,i){X(o,t,i),$(l,t,null),c(t,e),r=!0},p(o,i){const a={};i&16&&(a.post=o[9]),i&4&&(a.user=o[2]),i&8&&(a.jwt=o[3]),l.$set(a)},i(o){r||(w(l.$$.fragment,o),r=!0)},o(o){E(l.$$.fragment,o),r=!1},d(o){o&&m(t),ee(l)}}}function mt(s){let t,l,e,r,o=s[0]!==""&&Ge(s),i=ze(s[4]),a=[];for(let f=0;f<i.length;f+=1)a[f]=Je(Fe(s,i,f));const I=f=>E(a[f],1,1,()=>{a[f]=null});return{c(){t=v("div"),o&&o.c(),l=P(),e=v("ul");for(let f=0;f<a.length;f+=1)a[f].c();this.h()},l(f){t=b(f,"DIV",{class:!0});var u=p(t);o&&o.l(u),l=U(u),e=b(u,"UL",{class:!0});var n=p(e);for(let d=0;d<a.length;d+=1)a[d].l(n);n.forEach(m),u.forEach(m),this.h()},h(){g(e,"class","flex flex-col gap-2"),g(t,"class","border flex flex-col bg-base-100 p-4")},m(f,u){X(f,t,u),o&&o.m(t,null),c(t,l),c(t,e);for(let n=0;n<a.length;n+=1)a[n]&&a[n].m(e,null);r=!0},p(f,[u]){if(f[0]!==""?o?o.p(f,u):(o=Ge(f),o.c(),o.m(t,l)):o&&(o.d(1),o=null),u&28){i=ze(f[4]);let n;for(n=0;n<i.length;n+=1){const d=Fe(f,i,n);a[n]?(a[n].p(d,u),w(a[n],1)):(a[n]=Je(d),a[n].c(),w(a[n],1),a[n].m(e,null))}for(fe(),n=i.length;n<a.length;n+=1)I(n);ue()}},i(f){if(!r){for(let u=0;u<i.length;u+=1)w(a[u]);r=!0}},o(f){a=a.filter(Boolean);for(let u=0;u<a.length;u+=1)E(a[u]);r=!1},d(f){f&&m(t),o&&o.d(),Ye(a,f)}}}function ht(s,t,l){let{title:e=""}=t,{items:r=[]}=t,{link:o="/"}=t,{sortBy:i=0}=t,{user:a}=t,{jwt:I}=t,f=r;function u(n,d){switch(d){case 0:l(4,f=[...n].sort((y,H)=>ce.fromISO(H.creationDate).toMillis()-ce.fromISO(y.creationDate).toMillis()));break;case 1:l(4,f=[...n].sort((y,H)=>H.upvotes.length-y.upvotes.length));break}}return s.$$set=n=>{"title"in n&&l(0,e=n.title),"items"in n&&l(5,r=n.items),"link"in n&&l(1,o=n.link),"sortBy"in n&&l(6,i=n.sortBy),"user"in n&&l(2,a=n.user),"jwt"in n&&l(3,I=n.jwt)},s.$$.update=()=>{s.$$.dirty&96&&u(r,i)},[e,o,a,I,f,r,i]}class kt extends ke{constructor(t){super(),Ee(this,t,ht,mt,we,{title:0,items:5,link:1,sortBy:6,user:2,jwt:3})}}export{kt as C};
