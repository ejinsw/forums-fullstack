import{s as Me,r as Ae}from"./scheduler.Cy9pk9AM.js";import{S as Pe,i as Ue,e as D,t as $,s as H,k as Z,c as I,a as y,b as q,d as h,f as V,l as x,m as j,g as le,h as c,n as ee,v as De,j as Y,x as se,p as B,w as ne,o as g,q as te,C as Le,D as Ie}from"./index.x6j4SjtJ.js";import{e as ye}from"./spread.4dapbekP.js";import{D as ae,U as Oe,B as Ne,a as He,b as Ve}from"./bxs-downvote.Be72qWU0.js";import{P as $e}from"./Popup.DfimPbFN.js";import{g as Ee}from"./entry.B3rq6gI2.js";import{e as Se}from"./public.CpIIhdHb.js";function je(s){let t,r,e=s[0].user.username+"",l,o,f=s[0].parent.user.username+"",a;return{c(){t=D("p"),r=$("@"),l=$(e),o=$(" replied to @"),a=$(f),this.h()},l(i){t=I(i,"P",{class:!0});var n=y(t);r=q(n,"@"),l=q(n,e),o=q(n," replied to @"),a=q(n,f),n.forEach(h),this.h()},h(){j(t,"class","text-sm text-gray-400")},m(i,n){le(i,t,n),c(t,r),c(t,l),c(t,o),c(t,a)},p(i,n){n&1&&e!==(e=i[0].user.username+"")&&Y(l,e),n&1&&f!==(f=i[0].parent.user.username+"")&&Y(a,f)},d(i){i&&h(t)}}}function qe(s){let t,r;return t=new Oe({}),{c(){Z(t.$$.fragment)},l(e){x(t.$$.fragment,e)},m(e,l){ee(t,e,l),r=!0},i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){B(t.$$.fragment,e),r=!1},d(e){te(t,e)}}}function ze(s){let t,r;return t=new Ne({}),{c(){Z(t.$$.fragment)},l(e){x(t.$$.fragment,e)},m(e,l){ee(t,e,l),r=!0},i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){B(t.$$.fragment,e),r=!1},d(e){te(t,e)}}}function Fe(s){let t,r;return t=new He({}),{c(){Z(t.$$.fragment)},l(e){x(t.$$.fragment,e)},m(e,l){ee(t,e,l),r=!0},i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){B(t.$$.fragment,e),r=!1},d(e){te(t,e)}}}function Ge(s){let t,r;return t=new Ve({}),{c(){Z(t.$$.fragment)},l(e){x(t.$$.fragment,e)},m(e,l){ee(t,e,l),r=!0},i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){B(t.$$.fragment,e),r=!1},d(e){te(t,e)}}}function Je(s){let t,r,e,l,o=s[0].isDeleted?"Deleted":`${s[0].post.title} | ${s[0].post.user.username}`,f,a,i,n,_,m=s[5](s[0].creationDate)+"",v,re,T,K,Q,N,d=(s[0].isDeleted?"[This comment has been deleted]":s[0].content)+"",E,z,U,S,O,b,w,ie,R,oe,ue,F,C,M,A,fe,ce;T=new $e({props:{items:s[1]&&s[1].id===s[0].userId?s[8]:s[9]}});let p=s[0].parent&&je(s);const me=[ze,qe],G=[];function de(u,k){return u[3]?0:1}b=de(s),w=G[b]=me[b](s);const _e=[Ge,Fe],J=[];function he(u,k){return u[2]?0:1}return C=he(s),M=J[C]=_e[C](s),{c(){t=D("div"),r=D("li"),e=D("div"),l=D("a"),f=$(o),n=H(),_=D("small"),v=$(m),re=H(),Z(T.$$.fragment),K=H(),p&&p.c(),Q=H(),N=D("p"),E=$(d),z=H(),U=D("span"),S=D("div"),O=D("button"),w.c(),ie=H(),R=D("small"),oe=$(s[4]),ue=H(),F=D("button"),M.c(),this.h()},l(u){t=I(u,"DIV",{class:!0});var k=y(t);r=I(k,"LI",{});var P=y(r);e=I(P,"DIV",{class:!0});var L=y(e);l=I(L,"A",{class:!0,href:!0});var W=y(l);f=q(W,o),W.forEach(h),n=V(L),_=I(L,"SMALL",{class:!0});var pe=y(_);v=q(pe,m),pe.forEach(h),re=V(L),x(T.$$.fragment,L),L.forEach(h),K=V(P),p&&p.l(P),Q=V(P),N=I(P,"P",{class:!0});var ge=y(N);E=q(ge,d),ge.forEach(h),z=V(P),U=I(P,"SPAN",{class:!0});var ve=y(U);S=I(ve,"DIV",{class:!0});var X=y(S);O=I(X,"BUTTON",{});var be=y(O);w.l(be),be.forEach(h),ie=V(X),R=I(X,"SMALL",{class:!0});var we=y(R);oe=q(we,s[4]),we.forEach(h),ue=V(X),F=I(X,"BUTTON",{});var ke=y(F);M.l(ke),ke.forEach(h),X.forEach(h),ve.forEach(h),P.forEach(h),k.forEach(h),this.h()},h(){j(l,"class",a="text-sm hover:text-primary "+(s[0].isDeleted&&"italic")),j(l,"href",i=`/posts/${s[0].postId}`),j(_,"class","text-xs ml-auto"),j(e,"class","flex items-center"),j(N,"class","text-sm"),j(R,"class","text-xs"),j(S,"class","flex gap-2 text-sm rounded-xl bg-base-300 px-2 py-1"),j(U,"class","flex gap-2"),j(t,"class","flex flex-col")},m(u,k){le(u,t,k),c(t,r),c(r,e),c(e,l),c(l,f),c(e,n),c(e,_),c(_,v),c(e,re),ee(T,e,null),c(r,K),p&&p.m(r,null),c(r,Q),c(r,N),c(N,E),c(r,z),c(r,U),c(U,S),c(S,O),G[b].m(O,null),c(S,ie),c(S,R),c(R,oe),c(S,ue),c(S,F),J[C].m(F,null),A=!0,fe||(ce=[De(O,"click",s[6]),De(F,"click",s[7])],fe=!0)},p(u,[k]){(!A||k&1)&&o!==(o=u[0].isDeleted?"Deleted":`${u[0].post.title} | ${u[0].post.user.username}`)&&Y(f,o),(!A||k&1&&a!==(a="text-sm hover:text-primary "+(u[0].isDeleted&&"italic")))&&j(l,"class",a),(!A||k&1&&i!==(i=`/posts/${u[0].postId}`))&&j(l,"href",i),(!A||k&1)&&m!==(m=u[5](u[0].creationDate)+"")&&Y(v,m);const P={};k&3&&(P.items=u[1]&&u[1].id===u[0].userId?u[8]:u[9]),T.$set(P),u[0].parent?p?p.p(u,k):(p=je(u),p.c(),p.m(r,Q)):p&&(p.d(1),p=null),(!A||k&1)&&d!==(d=(u[0].isDeleted?"[This comment has been deleted]":u[0].content)+"")&&Y(E,d);let L=b;b=de(u),b!==L&&(se(),B(G[L],1,1,()=>{G[L]=null}),ne(),w=G[b],w||(w=G[b]=me[b](u),w.c()),g(w,1),w.m(O,null)),(!A||k&16)&&Y(oe,u[4]);let W=C;C=he(u),C!==W&&(se(),B(J[W],1,1,()=>{J[W]=null}),ne(),M=J[C],M||(M=J[C]=_e[C](u),M.c()),g(M,1),M.m(F,null))},i(u){A||(g(T.$$.fragment,u),g(w),g(M),A=!0)},o(u){B(T.$$.fragment,u),B(w),B(M),A=!1},d(u){u&&h(t),te(T),p&&p.d(),G[b].d(),J[C].d(),fe=!1,Ae(ce)}}}function Ke(s,t,r){let e,l,o,f,a,i,n,{comment:_}=t,{user:m}=t,{jwt:v}=t;function re(d){const E=ae.fromISO(d),z=ae.now().diff(E),U=z.as("minutes"),S=z.as("hours"),O=z.as("days");if(U<60)return`${Math.floor(U)} minutes ago`;if(S<24){const b=Math.floor(S),w=Math.floor(U%60);return`${b}h ${w}m ago`}else{const b=Math.floor(O),w=Math.floor(S%24);return`${b} days ${w}h ago`}}async function T(){if(!m||!v){Ee("/login");return}i&&K();const d=await fetch(`${Se.PUBLIC_API_HOST}/api/comments/${_.id}/upvote`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`}});if(d.ok)a?r(12,e=e.filter(E=>E.userId!==m.id)):r(12,e=[...e,{id:0,user:m,userId:m.id}]);else{const E=await d.json();console.error("Error:",E)}}async function K(){if(!m||!v){Ee("/login");return}a&&T();const d=await fetch(`${Se.PUBLIC_API_HOST}/api/comments/${_.id}/downvote`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`}});if(d.ok)i?r(11,l=l.filter(E=>E.userId!==m.id)):r(11,l=[...l,{id:0,user:m,userId:m.id}]);else{const E=await d.json();console.error("Error:",E)}}const Q=[{title:"Share",callback(){console.log("Share")}}],N=[{title:"Share",callback(){console.log("Share")}}];return s.$$set=d=>{"comment"in d&&r(0,_=d.comment),"user"in d&&r(1,m=d.user),"jwt"in d&&r(10,v=d.jwt)},s.$$.update=()=>{s.$$.dirty&1&&r(12,e=_.upvotes),s.$$.dirty&1&&r(11,l=_.downvotes),s.$$.dirty&4096&&r(14,o=e?e.map(d=>d.userId):null),s.$$.dirty&2048&&r(13,f=l?l.map(d=>d.userId):null),s.$$.dirty&16386&&r(3,a=m&&o?o.includes(m.id):!1),s.$$.dirty&8194&&r(2,i=m&&f?f.includes(m.id):!1),s.$$.dirty&6144&&r(4,n=e&&l?e.length-l.length:"N/A")},[_,m,i,a,n,re,T,K,Q,N,v,l,e,f,o]}class Qe extends Pe{constructor(t){super(),Ue(this,t,Ke,Je,Me,{comment:0,user:1,jwt:10})}}function Be(s,t,r){const e=s.slice();return e[7]=t[r],e}function Te(s){let t,r,e,l;return r=new Qe({props:{comment:s[7],user:s[0],jwt:s[1]}}),{c(){t=D("li"),Z(r.$$.fragment),e=H()},l(o){t=I(o,"LI",{});var f=y(t);x(r.$$.fragment,f),e=V(f),f.forEach(h)},m(o,f){le(o,t,f),ee(r,t,null),c(t,e),l=!0},p(o,f){const a={};f&4&&(a.comment=o[7]),f&1&&(a.user=o[0]),f&2&&(a.jwt=o[1]),r.$set(a)},i(o){l||(g(r.$$.fragment,o),l=!0)},o(o){B(r.$$.fragment,o),l=!1},d(o){o&&h(t),te(r)}}}function Ce(s){let t,r,e=!s[7].isDeleted&&Te(s);return{c(){e&&e.c(),t=Ie()},l(l){e&&e.l(l),t=Ie()},m(l,o){e&&e.m(l,o),le(l,t,o),r=!0},p(l,o){l[7].isDeleted?e&&(se(),B(e,1,1,()=>{e=null}),ne()):e?(e.p(l,o),o&4&&g(e,1)):(e=Te(l),e.c(),g(e,1),e.m(t.parentNode,t))},i(l){r||(g(e),r=!0)},o(l){B(e),r=!1},d(l){l&&h(t),e&&e.d(l)}}}function Re(s){let t,r,e,l=ye(s[2]),o=[];for(let a=0;a<l.length;a+=1)o[a]=Ce(Be(s,l,a));const f=a=>B(o[a],1,1,()=>{o[a]=null});return{c(){t=D("div"),r=D("ul");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){t=I(a,"DIV",{class:!0});var i=y(t);r=I(i,"UL",{class:!0});var n=y(r);for(let _=0;_<o.length;_+=1)o[_].l(n);n.forEach(h),i.forEach(h),this.h()},h(){j(r,"class","flex flex-col gap-2"),j(t,"class","border flex flex-col bg-base-100 p-4")},m(a,i){le(a,t,i),c(t,r);for(let n=0;n<o.length;n+=1)o[n]&&o[n].m(r,null);e=!0},p(a,[i]){if(i&7){l=ye(a[2]);let n;for(n=0;n<l.length;n+=1){const _=Be(a,l,n);o[n]?(o[n].p(_,i),g(o[n],1)):(o[n]=Ce(_),o[n].c(),g(o[n],1),o[n].m(r,null))}for(se(),n=l.length;n<o.length;n+=1)f(n);ne()}},i(a){if(!e){for(let i=0;i<l.length;i+=1)g(o[i]);e=!0}},o(a){o=o.filter(Boolean);for(let i=0;i<o.length;i+=1)B(o[i]);e=!1},d(a){a&&h(t),Le(o,a)}}}function We(s,t,r){let{items:e=[]}=t,{sortBy:l=0}=t,{user:o}=t,{jwt:f}=t,a=e;function i(n,_){switch(_){case 0:r(2,a=[...n].sort((m,v)=>ae.fromISO(v.creationDate).toMillis()-ae.fromISO(m.creationDate).toMillis()));break;case 1:r(2,a=[...n].sort((m,v)=>v.upvotes.length-m.upvotes.length));break}}return s.$$set=n=>{"items"in n&&r(3,e=n.items),"sortBy"in n&&r(4,l=n.sortBy),"user"in n&&r(0,o=n.user),"jwt"in n&&r(1,f=n.jwt)},s.$$.update=()=>{s.$$.dirty&24&&i(e,l)},[o,f,a,e,l]}class lt extends Pe{constructor(t){super(),Ue(this,t,We,Re,Me,{items:3,sortBy:4,user:0,jwt:1})}}export{lt as C};
